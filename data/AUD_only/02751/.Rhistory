data_raw <- fromJSON(file = "spatial_working_memory_task_inv-results.json", method = "C", unexpected.escape = "error", simplify = T)
} else {
stop(c("No SWM JSON file found for ID ",subj))
}
#extract first entry of the list
data_first_entry <- data_raw[1]
#save list as character string (fromJSON function needs json string)
data_as_chr <-as.character(data_first_entry)
# convert to list
data_list <- fromJSON(json_str = data_as_chr)
# json file contains empty values for skipped 2nd questions. Replace them by NA in order
# to transform the list to a data frame later
for(i in 1:length(data_list)){
if(data_list[[i]][["ended_on"]]=="skipped")
data_list[[i]][["duration"]]=NA}
# fix the space in question2 for algorithm to work
data_list[[95]][["sender"]]="question2"
# extract training trials
Training <- data_list[c(31,32,43,44,62,63,80,81)]
Training=ldply(Training,data.frame) # side note: 1 correct response is missing
# in training trial 6_15, question 1
# remove them from data_list, so they won't be fetched in the following
data_list <- data_list[-c(1:85)]
# extract responses for question 1 and question 2 and turn it into data frame
spatial_mem<-c()
serial_mem <- c()
new_element <-c()
for (j in 1:length(data_list)) {
if (data_list[[j]][["sender"]]=="question" | data_list[[j]][["sender"]]=="question1" |data_list[[j]][["sender"]]=="question2")
spatial_mem[[length(spatial_mem)+1]]<- (data_list[[j]]) }
spatial_mem=ldply(spatial_mem,data.frame)
#change data type for further processing
spatial_mem$sender<- as.character(spatial_mem$sender)
spatial_mem$sender_type<- as.character(spatial_mem$sender_type)
spatial_mem$sender_id<- as.character(spatial_mem$sender_id)
spatial_mem$ended_on<- as.character(spatial_mem$ended_on)
spatial_mem$timestamp<- as.character(spatial_mem$timestamp)
#grouping in 4 step and 7 step conditions (including all trials SHOWN in the task)
item4_tmp_num <- subset(spatial_mem[1:48, ])
item4_tmp2_num <- subset(spatial_mem[145:192, ])
item4_tmp_num<- rbind(item4_tmp_num,item4_tmp2_num)
item7_tmp_num <- subset(spatial_mem[49:144, ])
#grouping in spatial memory(q1) and serial memory(q2) conditions (including all trials SHOWN in the task)
SWM_q1_num <- subset(spatial_mem, sender == "question"|sender == "question1")
SWM_q2_num <- subset(spatial_mem, sender == "question2")
#exclude RTs <150 ms (participant probably clicked randomly)
#so these variables will be used to count the number of trials USED in the analyses
#Info: there are some negative RTs in the data and I don't know how this is possible
RToutlierQ1 <- subset(SWM_q1_num, duration < 150 & is.na(duration)==FALSE)
RToutlier <- rbind(RToutlierQ1,subset(SWM_q2_num, duration < 150 & is.na(duration) == FALSE))
item4_tmp <- subset(item4_tmp_num, duration >= 150 | is.na(duration)==TRUE)
item7_tmp <- subset(item7_tmp_num, duration >= 150 | is.na(duration)==TRUE)
SWM_q1 <- subset(SWM_q1_num, duration >= 150 | is.na(duration)==TRUE)
SWM_q2 <- subset(SWM_q2_num, duration >= 150 | is.na(duration)==TRUE)
#general calculations
SWM_nbCorr_4 = length(which(item4_tmp$correct==TRUE & item4_tmp$sender == "question" |
item4_tmp$sender == "question1" & item4_tmp$correct==TRUE))     # spatial mem nb corr 4 items
SWM_nbErr_4 = length(which(item4_tmp$correct==FALSE & item4_tmp$sender == "question" |
item4_tmp$sender == "question1" & item4_tmp$correct==FALSE ))   # spatial mem nb err 4 times
SER_nbCorr_4 = length(which(item4_tmp$correct==TRUE & item4_tmp$sender == "question2"))    # serial mem nb corr 4 items
SER_nbErr_4 = length(which(item4_tmp$correct==FALSE & item4_tmp$sender == "question2"))    # serial mem nb err 4 times
SWM_nbCorr_7 = length(which(item7_tmp$correct==TRUE & item7_tmp$sender == "question" |
item7_tmp$sender == "question1"& item7_tmp$correct==TRUE))      # spatial mem nb corr 7 items
SWM_nbErr_7 = length(which(item7_tmp$correct==FALSE & item7_tmp$sender == "question" |
item7_tmp$sender == "question1" & item7_tmp$correct==FALSE ))   # spatial mem nb err 7 times
SER_nbCorr_7 = length(which(item7_tmp$correct==TRUE & item7_tmp$sender == "question2"))    # serial mem nb corr 7 items
SER_nbErr_7 = length(which(item7_tmp$correct==FALSE & item7_tmp$sender == "question2"))    # serial mem nb err 7 times
######### compute SWM measures ######################################################################################
# subject info
SWM[f,1]  = subj
#task measures
SWM[f,2] = mean(item4_tmp$duration[(item4_tmp$sender == "question" |
item4_tmp$sender == "question1") & item4_tmp$correct==TRUE], na.rm = T)    # spatial memory rt correct 4 items
SWM[f,3] = mean(item4_tmp$duration[(item4_tmp$sender == "question" |
item4_tmp$sender == "question1") & item4_tmp$correct==FALSE], na.rm = T)   # spatial memory rt error 4 items
SWM[f,4] = mean(item4_tmp$duration[(item4_tmp$sender == "question2") &
item4_tmp$correct==TRUE], na.rm = T)            # serial memory rt correct 4 items
SWM[f,5] = mean(item4_tmp$duration[(item4_tmp$sender == "question2") &
item4_tmp$correct==FALSE], na.rm = T)            # serial memory rt error 4 items
SWM[f,6] = mean(item7_tmp$duration[(item7_tmp$sender == "question" |
item7_tmp$sender == "question1") & item7_tmp$correct==TRUE], na.rm = T)    # spatial memory rt correct 7 items
SWM[f,7] = mean(item7_tmp$duration[(item7_tmp$sender == "question" |
item7_tmp$sender == "question1") & item7_tmp$correct==FALSE], na.rm = T)   # spatial memory rt error 7 items
SWM[f,8] = mean(item7_tmp$duration[(item7_tmp$sender == "question2") &
item7_tmp$correct==TRUE], na.rm = T)             # serial memory rt correct 7 items
SWM[f,9] = mean(item7_tmp$duration[(item7_tmp$sender == "question2") &
item7_tmp$correct==FALSE], na.rm = T)            # serial memory rt error 7 items
SWM[f,10] = SWM_nbCorr_4    # spatial mem nb corr 4 items
SWM[f,11] = SWM_nbErr_4     # spatial mem nb err 4 items
SWM[f,12] = SER_nbCorr_4    # serial mem nb corr 4 items
SWM[f,13] = SER_nbErr_4     # serial mem nb err 4 items
SWM[f,14] = SWM_nbCorr_7    # spatial mem nb corr 7 items
SWM[f,15] = SWM_nbErr_7     # spatial mem nb err 7 items
SWM[f,16] = SER_nbCorr_7    # serial mem nb corr 7 items
SWM[f,17] = SER_nbErr_7     # serial mem nb err 7 items
SWM[f,18] = SWM_nbCorr_4 + SWM_nbCorr_7    # spatial mem nb corr total
SWM[f,19] = SWM_nbErr_4 + SWM_nbErr_7   # spatial mem nb err total
SWM[f,20] = SER_nbCorr_4 + SER_nbCorr_7    # serial mem nb corr total
SWM[f,21] = SER_nbErr_4 + SER_nbErr_7   # serial mem nb err total
SWM[f,22] = nrow(RToutlier)                          # number of RT below 150 ms that were excluded
# extract Spatial mem and Serial mem for 4- and 7-item trials
numq1i4 <- subset(item4_tmp,sender=="question" | sender =="question1")
numq2i4 <- subset(item4_tmp,sender=="question2")
numq1i7 <- subset(item7_tmp,sender=="question" | sender =="question1")
numq2i7 <- subset(item7_tmp,sender=="question2")
SWM[f,23] = nrow(numq1i4)
SWM[f,24] = nrow(numq2i4)
SWM[f,25] = nrow(numq1i7)
SWM[f,26] = nrow(numq2i7)
SWM[f,27] = nrow(SWM_q1)
SWM[f,28] = nrow(SWM_q2)
# calculate task measures
SWM[f,29] = sd(item4_tmp$duration[(item4_tmp$sender == "question" |
item4_tmp$sender == "question1") &
item4_tmp$correct==TRUE ], na.rm = T) # spatial mem sd(rt) correct 4 items
SWM[f,30] = sd(item4_tmp$duration[(item4_tmp$sender == "question" |
item4_tmp$sender == "question1") &
item4_tmp$correct==FALSE], na.rm = T) # spatial mem sd(rt) error 4 items
SWM[f,31] = sd(item4_tmp$duration[item4_tmp$sender=="question2" &
item4_tmp$correct==TRUE],na.rm=T)     # ser mem sd(rt) correct 4 items
SWM[f,32] = sd(item4_tmp$duration[item4_tmp$sender=="question2" &
item4_tmp$correct==FALSE],na.rm=T)    # ser mem sd(rt) error 4 items
SWM[f,33] = sd(item7_tmp$duration[(item7_tmp$sender == "question" |
item7_tmp$sender == "question1") &
item7_tmp$correct==TRUE], na.rm = T)  # spatial mem sd(rt) correct 7 items
SWM[f,34] = sd(item7_tmp$duration[(item7_tmp$sender == "question" |
item7_tmp$sender == "question1") &
item7_tmp$correct==FALSE], na.rm = T) # spatial mem sd(rt) error 7 items
SWM[f,35] = sd(item7_tmp$duration[item7_tmp$sender=="question2" &
item7_tmp$correct==TRUE],na.rm=T)     # ser mem sd(rt) correct 7 items
SWM[f,36] = sd(item7_tmp$duration[item7_tmp$sender=="question2"&
item7_tmp$correct==FALSE],na.rm=T)    # ser mem sd(rt) error 7 items
SWM[f,37] = sd(SWM_q1$duration[SWM_q1$correct==TRUE],na.rm=T)             # spatial mem sd(rt) correct total
SWM[f,38] = sd(SWM_q1$duration[SWM_q1$correct==FALSE],na.rm=T)            # spatial mem sd(rt) error total
SWM[f,39] = sd(SWM_q2$duration[SWM_q2$correct==TRUE],na.rm=T)             # serial mem sd(rt) correct total
SWM[f,40] = sd(SWM_q2$duration[SWM_q2$correct==FALSE],na.rm=T)            # serial mem sd(rt) error total
SWM[f,41] = sqrt(sd(SWM_q1$duration[SWM_q1$correct==TRUE],na.rm=T))       # spatial mem sqrt(sd(rt)) correct total
SWM[f,42] = sqrt(sd(SWM_q1$duration[SWM_q1$correct==FALSE],na.rm=T))      # spatial mem sqrt(sd(rt)) error total
SWM[f,43] = sqrt(sd(SWM_q2$duration[SWM_q2$correct==TRUE],na.rm=T))       # serial mem sqrt(sd(rt)) correct total
SWM[f,44] = sqrt(sd(SWM_q2$duration[SWM_q2$correct==FALSE],na.rm=T))      # serial mem sqrt(sd(rt)) error total
# missing trials (timeouts)
SWM_miss_4 <- subset(item4_tmp, sender=="question" & ended_on == "timeout" |sender=="question1" & ended_on == "timeout")
SER_miss_4 <- subset(item4_tmp, sender=="question2" & ended_on == "timeout")
SWM_miss_7 <- subset(item7_tmp, sender=="question" & ended_on == "timeout"| sender=="question1" & ended_on == "timeout")
SER_miss_7 = subset(item7_tmp, sender=="question2" & ended_on == "timeout")
SWM[f,45] = nrow(SWM_miss_4)
SWM[f,46] = nrow(SER_miss_4)
SWM[f,47] = nrow(SWM_miss_7)
SWM[f,48] = nrow(SER_miss_7)
# accuracy scores
SWM[f,49] = ((SWM_nbCorr_4)/(nrow(numq1i4)-nrow(SWM_miss_4)))*100
SWM[f,50] = ((SER_nbCorr_4)/(nrow(numq2i4)-nrow(SWM_miss_4)))*100
SWM[f,51] = ((SWM_nbCorr_7)/(nrow(numq1i7)-nrow(SWM_miss_7)))*100
SWM[f,52] = ((SER_nbCorr_7)/(nrow(numq2i7)-nrow(SER_miss_7)))*100
SWM[f,53] = ((SWM_nbCorr_4 + SWM_nbCorr_7)/(nrow(numq1i4) + nrow(numq1i7) -
nrow(SWM_miss_4) - nrow(SWM_miss_7)))*100
SWM[f,54] = ((SER_nbCorr_4 + SER_nbCorr_7)/(nrow(numq2i4) + nrow(numq2i7) -
nrow(SER_miss_4) - nrow(SER_miss_7)))*100
#number of trials shown in the task (including trials that were excluded in the analyses, just to check if everything is there)
SWM[f,55] = nrow(item4_tmp_num)
SWM[f,56] = nrow(item7_tmp_num)
SWM[f,57] = nrow(SWM_q1_num)
SWM[f,58] = nrow(SWM_q2_num)
## report subjects with problems reading the logfile
setwd(datadir)
}
#set datadir as relative to this file's directory
#(assuming source file location is current working dir)
datadir = getwd()
sessionInfo()
#clear workspace
rm(list = ls())
#put packages in library
library(rjson)
library(plyr)
#set datadir as relative to this file's directory
#(assuming source file location is current working dir)
datadir = "C:/Users/jstef/Nextcloud/SESYN/_B09/SATPD2_AUD/plandepth_aud/data" # getwd()
groupdirs = list.dirs(datadir, recursive = FALSE)
iddirs <- list()
for (g in groupdirs){
f <- list.dirs(g, recursive = FALSE, full.names = FALSE)
f <- f[grepl('[0-9]{5}', perl = TRUE,f)]  # filter for dirs containing IDs
iddirs <- c(iddirs, file.path(g,f))
}
nid = max(c(length(iddirs)))
SWM = array(NA, c(nid, 58))
# for (f in 1:nid){
f=29
txtpath = toString(iddirs[f])
subj    = basename(txtpath)
setwd(txtpath)
#data extraction from json-files starts here
tmp = dir(txtpath)
if ("spatial_working_memory_task-results.json" %in% tmp) {
data_raw <- fromJSON(file = "spatial_working_memory_task-results.json", method = "C", unexpected.escape = "error", simplify = T)
} else if ("spatial_working_memory_task_inv-results.json" %in% tmp){
data_raw <- fromJSON(file = "spatial_working_memory_task_inv-results.json", method = "C", unexpected.escape = "error", simplify = T)
} else {
stop(c("No SWM JSON file found for ID ",subj))
}
#extract first entry of the list
data_first_entry <- data_raw[1]
#save list as character string (fromJSON function needs json string)
data_as_chr <-as.character(data_first_entry)
# convert to list
data_list <- fromJSON(json_str = data_as_chr)
# json file contains empty values for skipped 2nd questions. Replace them by NA in order
# to transform the list to a data frame later
for(i in 1:length(data_list)){
if(data_list[[i]][["ended_on"]]=="skipped")
data_list[[i]][["duration"]]=NA}
# fix the space in question2 for algorithm to work
data_list[[95]][["sender"]]="question2"
# extract training trials
Training <- data_list[c(31,32,43,44,62,63,80,81)]
Training=ldply(Training,data.frame) # side note: 1 correct response is missing
# remove them from data_list, so they won't be fetched in the following
data_list <- data_list[-c(1:85)]
# extract responses for question 1 and question 2 and turn it into data frame
spatial_mem<-c()
serial_mem <- c()
new_element <-c()
for (j in 1:length(data_list)) {
if (data_list[[j]][["sender"]]=="question" | data_list[[j]][["sender"]]=="question1" |data_list[[j]][["sender"]]=="question2")
spatial_mem[[length(spatial_mem)+1]]<- (data_list[[j]]) }
#spatial_mem<-spatial_mem[-c(18)]
spatial_mem=data.frame(spatial_mem)
# extract responses for question 1 and question 2 and turn it into data frame
spatial_mem<-c()
serial_mem <- c()
new_element <-c()
for (j in 1:length(data_list)) {
if (data_list[[j]][["sender"]]=="question" | data_list[[j]][["sender"]]=="question1" |data_list[[j]][["sender"]]=="question2")
spatial_mem[[length(spatial_mem)+1]]<- (data_list[[j]]) }
#spatial_mem<-spatial_mem[-c(18)]
spatial_mem=data.frame(spatial_mem)
# extract responses for question 1 and question 2 and turn it into data frame
spatial_mem<-c()
serial_mem <- c()
new_element <-c()
for (j in 1:length(data_list)) {
if (data_list[[j]][["sender"]]=="question" | data_list[[j]][["sender"]]=="question1" |data_list[[j]][["sender"]]=="question2")
spatial_mem[[length(spatial_mem)+1]]<- (data_list[[j]]) }
spatial_mem<-spatial_mem[-c(18)]
spatial_mem=data.frame(spatial_mem)
# extract responses for question 1 and question 2 and turn it into data frame
spatial_mem<-c()
serial_mem <- c()
new_element <-c()
for (j in 1:length(data_list)) {
if (data_list[[j]][["sender"]]=="question" | data_list[[j]][["sender"]]=="question1" |data_list[[j]][["sender"]]=="question2")
spatial_mem[[length(spatial_mem)+1]]<- (data_list[[j]]) }
spatial_mem<-spatial_mem[1:17]
spatial_mem=data.frame(spatial_mem)
# extract responses for question 1 and question 2 and turn it into data frame
spatial_mem<-c()
serial_mem <- c()
new_element <-c()
for (j in 1:length(data_list)) {
if (data_list[[j]][["sender"]]=="question" | data_list[[j]][["sender"]]=="question1" |data_list[[j]][["sender"]]=="question2")
spatial_mem[[length(spatial_mem)+1]]<- (data_list[[j]]) }
spatial_mem<-spatial_mem[1:18]
spatial_mem=data.frame(spatial_mem)
# extract responses for question 1 and question 2 and turn it into data frame
spatial_mem<-c()
serial_mem <- c()
new_element <-c()
for (j in 1:length(data_list)) {
if (data_list[[j]][["sender"]]=="question" | data_list[[j]][["sender"]]=="question1" |data_list[[j]][["sender"]]=="question2")
spatial_mem[[length(spatial_mem)+1]]<- (data_list[[j]]) }
spatial_mem<-spatial_mem[1:18]
View(spatial_mem)
# extract responses for question 1 and question 2 and turn it into data frame
spatial_mem<-c()
serial_mem <- c()
new_element <-c()
for (j in 1:length(data_list)) {
if (data_list[[j]][["sender"]]=="question" | data_list[[j]][["sender"]]=="question1" |data_list[[j]][["sender"]]=="question2")
spatial_mem[[length(spatial_mem)+1]]<- (data_list[[j]]) }
spatial_mem<-spatial_mem[1:19]
spatial_mem=data.frame(spatial_mem)
# extract responses for question 1 and question 2 and turn it into data frame
spatial_mem<-c()
serial_mem <- c()
new_element <-c()
for (j in 1:length(data_list)) {
if (data_list[[j]][["sender"]]=="question" | data_list[[j]][["sender"]]=="question1" |data_list[[j]][["sender"]]=="question2")
spatial_mem[[length(spatial_mem)+1]]<- (data_list[[j]]) }
spatial_mem<-spatial_mem[1:20]
spatial_mem=data.frame(spatial_mem)
View(spatial_mem)
# extract responses for question 1 and question 2 and turn it into data frame
spatial_mem<-c()
serial_mem <- c()
new_element <-c()
for (j in 1:length(data_list)) {
if (data_list[[j]][["sender"]]=="question" | data_list[[j]][["sender"]]=="question1" |data_list[[j]][["sender"]]=="question2")
spatial_mem[[length(spatial_mem)+1]]<- (data_list[[j]]) }
View(spatial_mem)
# extract responses for question 1 and question 2 and turn it into data frame
spatial_mem<-c()
serial_mem <- c()
new_element <-c()
for (j in 1:length(data_list)) {
if (data_list[[j]][["sender"]]=="question" | data_list[[j]][["sender"]]=="question1" |data_list[[j]][["sender"]]=="question2")
spatial_mem[[length(spatial_mem)+1]]<- (data_list[[j]]) }
spatial_mem<-spatial_mem[-c(20)]
spatial_mem=data.frame(spatial_mem)
#clear workspace
rm(list = ls())
#put packages in library
library(rjson)
library(plyr)
#set datadir as relative to this file's directory
#(assuming source file location is current working dir)
datadir = getwd()
groupdirs = list.dirs(datadir, recursive = FALSE)
iddirs <- list()
for (g in groupdirs){
f <- list.dirs(g, recursive = FALSE, full.names = FALSE)
f <- f[grepl('[0-9]{5}', perl = TRUE,f)]  # filter for dirs containing IDs
iddirs <- c(iddirs, file.path(g,f))
}
nid = max(c(length(iddirs)))
SWM = array(NA, c(nid, 58))
for (f in 1:nid){
tryCatch({
txtpath = toString(iddirs[f])
subj    = basename(txtpath)
setwd(txtpath)
#data extraction from json-files starts here
tmp = dir(txtpath)
if ("spatial_working_memory_task-results.json" %in% tmp) {
data_raw <- fromJSON(file = "spatial_working_memory_task-results.json", method = "C", unexpected.escape = "error", simplify = T)
} else if ("spatial_working_memory_task_inv-results.json" %in% tmp){
data_raw <- fromJSON(file = "spatial_working_memory_task_inv-results.json", method = "C", unexpected.escape = "error", simplify = T)
} else {
stop(c("No SWM JSON file found for ID ",subj))
}
#extract first entry of the list
data_first_entry <- data_raw[1]
#save list as character string (fromJSON function needs json string)
data_as_chr <-as.character(data_first_entry)
# convert to list
data_list <- fromJSON(json_str = data_as_chr)
# json file contains empty values for skipped 2nd questions. Replace them by NA in order
# to transform the list to a data frame later
for(i in 1:length(data_list)){
if(data_list[[i]][["ended_on"]]=="skipped")
data_list[[i]][["duration"]]=NA}
# fix the space in question2 for algorithm to work
data_list[[95]][["sender"]]="question2"
# extract training trials
Training <- data_list[c(31,32,43,44,62,63,80,81)]
Training=ldply(Training,data.frame) # side note: 1 correct response is missing
# in training trial 6_15, question 1
# remove them from data_list, so they won't be fetched in the following
data_list <- data_list[-c(1:85)]
# extract responses for question 1 and question 2 and turn it into data frame
spatial_mem<-c()
serial_mem <- c()
new_element <-c()
for (j in 1:length(data_list)) {
if (data_list[[j]][["sender"]]=="question" | data_list[[j]][["sender"]]=="question1" |data_list[[j]][["sender"]]=="question2")
spatial_mem[[length(spatial_mem)+1]]<- (data_list[[j]]) }
if (subj=="02751") {
# remove trial with missing RT data (probably due to bug in task)
spatial_mem<-spatial_mem[-c(20)]
}
spatial_mem=ldply(spatial_mem,data.frame)
#change data type for further processing
spatial_mem$sender<- as.character(spatial_mem$sender)
spatial_mem$sender_type<- as.character(spatial_mem$sender_type)
spatial_mem$sender_id<- as.character(spatial_mem$sender_id)
spatial_mem$ended_on<- as.character(spatial_mem$ended_on)
spatial_mem$timestamp<- as.character(spatial_mem$timestamp)
#grouping in 4 step and 7 step conditions (including all trials SHOWN in the task)
item4_tmp_num <- subset(spatial_mem[1:48, ])
item4_tmp2_num <- subset(spatial_mem[145:192, ])
item4_tmp_num<- rbind(item4_tmp_num,item4_tmp2_num)
item7_tmp_num <- subset(spatial_mem[49:144, ])
#grouping in spatial memory(q1) and serial memory(q2) conditions (including all trials SHOWN in the task)
SWM_q1_num <- subset(spatial_mem, sender == "question"|sender == "question1")
SWM_q2_num <- subset(spatial_mem, sender == "question2")
#exclude RTs <150 ms (participant probably clicked randomly)
#so these variables will be used to count the number of trials USED in the analyses
#Info: there are some negative RTs in the data and I don't know how this is possible
RToutlierQ1 <- subset(SWM_q1_num, duration < 150 & is.na(duration)==FALSE)
RToutlier <- rbind(RToutlierQ1,subset(SWM_q2_num, duration < 150 & is.na(duration) == FALSE))
item4_tmp <- subset(item4_tmp_num, duration >= 150 | is.na(duration)==TRUE)
item7_tmp <- subset(item7_tmp_num, duration >= 150 | is.na(duration)==TRUE)
SWM_q1 <- subset(SWM_q1_num, duration >= 150 | is.na(duration)==TRUE)
SWM_q2 <- subset(SWM_q2_num, duration >= 150 | is.na(duration)==TRUE)
#general calculations
SWM_nbCorr_4 = length(which(item4_tmp$correct==TRUE & item4_tmp$sender == "question" |
item4_tmp$sender == "question1" & item4_tmp$correct==TRUE))     # spatial mem nb corr 4 items
SWM_nbErr_4 = length(which(item4_tmp$correct==FALSE & item4_tmp$sender == "question" |
item4_tmp$sender == "question1" & item4_tmp$correct==FALSE ))   # spatial mem nb err 4 times
SER_nbCorr_4 = length(which(item4_tmp$correct==TRUE & item4_tmp$sender == "question2"))    # serial mem nb corr 4 items
SER_nbErr_4 = length(which(item4_tmp$correct==FALSE & item4_tmp$sender == "question2"))    # serial mem nb err 4 times
SWM_nbCorr_7 = length(which(item7_tmp$correct==TRUE & item7_tmp$sender == "question" |
item7_tmp$sender == "question1"& item7_tmp$correct==TRUE))      # spatial mem nb corr 7 items
SWM_nbErr_7 = length(which(item7_tmp$correct==FALSE & item7_tmp$sender == "question" |
item7_tmp$sender == "question1" & item7_tmp$correct==FALSE ))   # spatial mem nb err 7 times
SER_nbCorr_7 = length(which(item7_tmp$correct==TRUE & item7_tmp$sender == "question2"))    # serial mem nb corr 7 items
SER_nbErr_7 = length(which(item7_tmp$correct==FALSE & item7_tmp$sender == "question2"))    # serial mem nb err 7 times
######### compute SWM measures ######################################################################################
# subject info
SWM[f,1]  = subj
#task measures
SWM[f,2] = mean(item4_tmp$duration[(item4_tmp$sender == "question" |
item4_tmp$sender == "question1") & item4_tmp$correct==TRUE], na.rm = T)    # spatial memory rt correct 4 items
SWM[f,3] = mean(item4_tmp$duration[(item4_tmp$sender == "question" |
item4_tmp$sender == "question1") & item4_tmp$correct==FALSE], na.rm = T)   # spatial memory rt error 4 items
SWM[f,4] = mean(item4_tmp$duration[(item4_tmp$sender == "question2") &
item4_tmp$correct==TRUE], na.rm = T)            # serial memory rt correct 4 items
SWM[f,5] = mean(item4_tmp$duration[(item4_tmp$sender == "question2") &
item4_tmp$correct==FALSE], na.rm = T)            # serial memory rt error 4 items
SWM[f,6] = mean(item7_tmp$duration[(item7_tmp$sender == "question" |
item7_tmp$sender == "question1") & item7_tmp$correct==TRUE], na.rm = T)    # spatial memory rt correct 7 items
SWM[f,7] = mean(item7_tmp$duration[(item7_tmp$sender == "question" |
item7_tmp$sender == "question1") & item7_tmp$correct==FALSE], na.rm = T)   # spatial memory rt error 7 items
SWM[f,8] = mean(item7_tmp$duration[(item7_tmp$sender == "question2") &
item7_tmp$correct==TRUE], na.rm = T)             # serial memory rt correct 7 items
SWM[f,9] = mean(item7_tmp$duration[(item7_tmp$sender == "question2") &
item7_tmp$correct==FALSE], na.rm = T)            # serial memory rt error 7 items
SWM[f,10] = SWM_nbCorr_4    # spatial mem nb corr 4 items
SWM[f,11] = SWM_nbErr_4     # spatial mem nb err 4 items
SWM[f,12] = SER_nbCorr_4    # serial mem nb corr 4 items
SWM[f,13] = SER_nbErr_4     # serial mem nb err 4 items
SWM[f,14] = SWM_nbCorr_7    # spatial mem nb corr 7 items
SWM[f,15] = SWM_nbErr_7     # spatial mem nb err 7 items
SWM[f,16] = SER_nbCorr_7    # serial mem nb corr 7 items
SWM[f,17] = SER_nbErr_7     # serial mem nb err 7 items
SWM[f,18] = SWM_nbCorr_4 + SWM_nbCorr_7    # spatial mem nb corr total
SWM[f,19] = SWM_nbErr_4 + SWM_nbErr_7   # spatial mem nb err total
SWM[f,20] = SER_nbCorr_4 + SER_nbCorr_7    # serial mem nb corr total
SWM[f,21] = SER_nbErr_4 + SER_nbErr_7   # serial mem nb err total
SWM[f,22] = nrow(RToutlier)                          # number of RT below 150 ms that were excluded
# extract Spatial mem and Serial mem for 4- and 7-item trials
numq1i4 <- subset(item4_tmp,sender=="question" | sender =="question1")
numq2i4 <- subset(item4_tmp,sender=="question2")
numq1i7 <- subset(item7_tmp,sender=="question" | sender =="question1")
numq2i7 <- subset(item7_tmp,sender=="question2")
SWM[f,23] = nrow(numq1i4)
SWM[f,24] = nrow(numq2i4)
SWM[f,25] = nrow(numq1i7)
SWM[f,26] = nrow(numq2i7)
SWM[f,27] = nrow(SWM_q1)
SWM[f,28] = nrow(SWM_q2)
# calculate task measures
SWM[f,29] = sd(item4_tmp$duration[(item4_tmp$sender == "question" |
item4_tmp$sender == "question1") &
item4_tmp$correct==TRUE ], na.rm = T) # spatial mem sd(rt) correct 4 items
SWM[f,30] = sd(item4_tmp$duration[(item4_tmp$sender == "question" |
item4_tmp$sender == "question1") &
item4_tmp$correct==FALSE], na.rm = T) # spatial mem sd(rt) error 4 items
SWM[f,31] = sd(item4_tmp$duration[item4_tmp$sender=="question2" &
item4_tmp$correct==TRUE],na.rm=T)     # ser mem sd(rt) correct 4 items
SWM[f,32] = sd(item4_tmp$duration[item4_tmp$sender=="question2" &
item4_tmp$correct==FALSE],na.rm=T)    # ser mem sd(rt) error 4 items
SWM[f,33] = sd(item7_tmp$duration[(item7_tmp$sender == "question" |
item7_tmp$sender == "question1") &
item7_tmp$correct==TRUE], na.rm = T)  # spatial mem sd(rt) correct 7 items
SWM[f,34] = sd(item7_tmp$duration[(item7_tmp$sender == "question" |
item7_tmp$sender == "question1") &
item7_tmp$correct==FALSE], na.rm = T) # spatial mem sd(rt) error 7 items
SWM[f,35] = sd(item7_tmp$duration[item7_tmp$sender=="question2" &
item7_tmp$correct==TRUE],na.rm=T)     # ser mem sd(rt) correct 7 items
SWM[f,36] = sd(item7_tmp$duration[item7_tmp$sender=="question2"&
item7_tmp$correct==FALSE],na.rm=T)    # ser mem sd(rt) error 7 items
SWM[f,37] = sd(SWM_q1$duration[SWM_q1$correct==TRUE],na.rm=T)             # spatial mem sd(rt) correct total
SWM[f,38] = sd(SWM_q1$duration[SWM_q1$correct==FALSE],na.rm=T)            # spatial mem sd(rt) error total
SWM[f,39] = sd(SWM_q2$duration[SWM_q2$correct==TRUE],na.rm=T)             # serial mem sd(rt) correct total
SWM[f,40] = sd(SWM_q2$duration[SWM_q2$correct==FALSE],na.rm=T)            # serial mem sd(rt) error total
SWM[f,41] = sqrt(sd(SWM_q1$duration[SWM_q1$correct==TRUE],na.rm=T))       # spatial mem sqrt(sd(rt)) correct total
SWM[f,42] = sqrt(sd(SWM_q1$duration[SWM_q1$correct==FALSE],na.rm=T))      # spatial mem sqrt(sd(rt)) error total
SWM[f,43] = sqrt(sd(SWM_q2$duration[SWM_q2$correct==TRUE],na.rm=T))       # serial mem sqrt(sd(rt)) correct total
SWM[f,44] = sqrt(sd(SWM_q2$duration[SWM_q2$correct==FALSE],na.rm=T))      # serial mem sqrt(sd(rt)) error total
# missing trials (timeouts)
SWM_miss_4 <- subset(item4_tmp, sender=="question" & ended_on == "timeout" |sender=="question1" & ended_on == "timeout")
SER_miss_4 <- subset(item4_tmp, sender=="question2" & ended_on == "timeout")
SWM_miss_7 <- subset(item7_tmp, sender=="question" & ended_on == "timeout"| sender=="question1" & ended_on == "timeout")
SER_miss_7 = subset(item7_tmp, sender=="question2" & ended_on == "timeout")
SWM[f,45] = nrow(SWM_miss_4)
SWM[f,46] = nrow(SER_miss_4)
SWM[f,47] = nrow(SWM_miss_7)
SWM[f,48] = nrow(SER_miss_7)
# accuracy scores
SWM[f,49] = ((SWM_nbCorr_4)/(nrow(numq1i4)-nrow(SWM_miss_4)))*100
SWM[f,50] = ((SER_nbCorr_4)/(nrow(numq2i4)-nrow(SWM_miss_4)))*100
SWM[f,51] = ((SWM_nbCorr_7)/(nrow(numq1i7)-nrow(SWM_miss_7)))*100
SWM[f,52] = ((SER_nbCorr_7)/(nrow(numq2i7)-nrow(SER_miss_7)))*100
SWM[f,53] = ((SWM_nbCorr_4 + SWM_nbCorr_7)/(nrow(numq1i4) + nrow(numq1i7) -
nrow(SWM_miss_4) - nrow(SWM_miss_7)))*100
SWM[f,54] = ((SER_nbCorr_4 + SER_nbCorr_7)/(nrow(numq2i4) + nrow(numq2i7) -
nrow(SER_miss_4) - nrow(SER_miss_7)))*100
#number of trials shown in the task (including trials that were excluded in the analyses, just to check if everything is there)
SWM[f,55] = nrow(item4_tmp_num)
SWM[f,56] = nrow(item7_tmp_num)
SWM[f,57] = nrow(SWM_q1_num)
SWM[f,58] = nrow(SWM_q2_num)
},
## report subjects with problems reading the logfile
error = function(e) {
message("a problem occured - please check subject folder: ", iddirs[f])
message("Here's the original error message:")
message(paste(e,"\n",sep=""))
} )
setwd(datadir)
}
